<!DOCTYPE html>
<html>
<head>
  <title>Client-Side PCB Stackup</title>
</head>
<body>
  <input type="file" id="fileInput" multiple>
  <div id="result">
    <!-- Result will be shown here -->
  </div>

  <script>
    function pcbStackup(fileList) {
      const readFiles = [];

      for (const file of fileList) {
        readFiles.push(new Promise((resolve, reject) => {
          const reader = new FileReader();

          reader.onload = () => {
            resolve({
              filename: file.name,
              gerber: reader.result,
            });
          };

          reader.onerror = () => {
            reject(new Error("Failed to read the file."));
          };

          reader.readAsText(file); // Adjust the read method as per your file type (binary, text, etc.)
        }));
      }

      return Promise.all(readFiles)
        .then(layers => {
          // Your existing implementation for stackup calculation...
          // (Assuming it returns the stackup object)

          return stackup; // Modify this to return the calculated stackup
        });
    }

    // Function to handle file input change event
    function handleFileInputChange(event) {
      const fileList = event.target.files;
      pcbStackup(fileList).then((stackup) => {
        // Do something with the stackup result, e.g., display it on the page
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
          <pre>${JSON.stringify(stackup, null, 2)}</pre>
        `;
      }).catch((error) => {
        console.error(error);
      });
    }

    // Add event listener to file input element
    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', handleFileInputChange);
  </script>
</body>
</html>
